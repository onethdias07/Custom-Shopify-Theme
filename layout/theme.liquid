<!doctype html>
<html class="no-js" lang="{{ request.locale.iso_code }}">
<head>
        {%- comment -%} 
        SEO Title following Shopify's official recommendations
        Enhanced with template system for better control
        {%- endcomment -%}
        <title>
          {%- liquid
            case request.page_type
              when 'index'
                if settings.seo_home_title != blank
                  echo settings.seo_home_title
                else
                  echo page_title
                endif
              when 'collection'
                if collection.metafields.seo.title != blank
                  echo collection.metafields.seo.title
                elsif settings.seo_collection_title != blank
                  echo settings.seo_collection_title | replace: '[collection]', collection.title
                else
                  echo page_title
                endif
              when 'product' 
                if product.metafields.seo.title != blank
                  echo product.metafields.seo.title
                elsif settings.seo_product_title != blank
                  echo settings.seo_product_title | replace: '[product]', product.title | replace: '[brand]', product.vendor
                else
                  echo page_title
                endif
              when 'blog'
                if blog.metafields.seo.title != blank
                  echo blog.metafields.seo.title
                elsif settings.seo_blog_title != blank
                  echo settings.seo_blog_title | replace: '[blog]', blog.title
                else
                  echo page_title
                endif
              when 'article'
                if article.metafields.seo.title != blank
                  echo article.metafields.seo.title
                elsif settings.seo_article_title != blank
                  echo settings.seo_article_title | replace: '[article]', article.title | replace: '[blog]', blog.title
                else
                  echo page_title
                endif
              when 'page'
                if page.metafields.seo.title != blank
                  echo page.metafields.seo.title
                elsif settings.seo_page_title != blank
                  echo settings.seo_page_title | replace: '[page]', page.title
                else
                  echo page_title
                endif
              else
                echo page_title
            endcase
          -%}
          {%- if current_tags %} &ndash; tagged "{{ current_tags | join: ', ' }}"{% endif -%}
          {%- if current_page != 1 %} &ndash; Page {{ current_page }}{% endif -%}
          {%- unless page_title contains shop.name %} &ndash; {{ shop.name }}{% endunless -%}
        </title>

        {%- comment -%} 
        Meta Description following Shopify's official recommendations
        Enhanced with template system and smart fallbacks
        {%- endcomment -%}
        {% if page_description %}
          <meta name="description" content="{{ page_description | escape }}">
        {% elsif settings.seo_home_description != blank and request.page_type == 'index' %}
          <meta name="description" content="{{ settings.seo_home_description | escape }}">
        {% elsif request.page_type == 'product' and settings.seo_product_description != blank %}
          <meta name="description" content="{{ settings.seo_product_description | replace: '[product]', product.title | replace: '[brand]', product.vendor | escape }}">
        {% elsif request.page_type == 'collection' and settings.seo_collection_description != blank %}
          <meta name="description" content="{{ settings.seo_collection_description | replace: '[collection]', collection.title | escape }}">
        {% elsif request.page_type == 'blog' and settings.seo_blog_description != blank %}
          <meta name="description" content="{{ settings.seo_blog_description | replace: '[blog]', blog.title | escape }}">
        {% elsif request.page_type == 'article' and settings.seo_article_description != blank %}
          <meta name="description" content="{{ settings.seo_article_description | replace: '[article]', article.title | replace: '[blog]', blog.title | escape }}">
        {% elsif request.page_type == 'page' and settings.seo_page_description != blank %}
          <meta name="description" content="{{ settings.seo_page_description | replace: '[page]', page.title | escape }}">
        {% elsif shop.description %}
          <meta name="description" content="{{ shop.description | escape }}">
        {% endif %}
        
        {%- comment -%} Additional SEO Meta Tags {%- endcomment -%}
        <meta name="keywords" content="{{ settings.seo_keywords | default: shop.name | escape }}">
        <meta name="author" content="{{ settings.seo_author | default: shop.name | escape }}">
        <meta name="robots" content="{{ settings.seo_robots | default: 'index, follow' }}">
        
        {%- if settings.seo_verify_google != blank -%}
          <meta name="google-site-verification" content="{{ settings.seo_verify_google }}">
        {%- endif -%}
        
        {%- if settings.seo_verify_bing != blank -%}
          <meta name="msvalidate.01" content="{{ settings.seo_verify_bing }}">
        {%- endif -%}
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width,initial-scale=1">
        <meta name="theme-color" content="#2c2c2c">
        
        {%- if settings.favicon != blank -%}
          <link rel="icon" type="image/png" href="{{ settings.favicon | img_url: '32x32' }}">
        {%- endif -%}

        {%- capture seo_title -%}
          {%- if request.page_type == 'search' and search.performed == true -%}
            {{ 'general.search.heading' | t: count: search.results_count }}: {{ 'general.search.results_with_count' | t: terms: search.terms, count: search.results_count }}
          {%- else -%}
            {{ page_title }}
          {%- endif -%}
          {%- if current_tags %} &ndash; {{ 'general.meta.tags' | t: tags: current_tags | join: ', ' }}{% endif -%}
          {%- if current_page != 1 %} &ndash; {{ 'general.meta.page' | t: page: current_page }}{% endif -%}
          {%- unless page_title contains shop.name %} &ndash; {{ shop.name }}{% endunless -%}
        {%- endcapture -%}
        <title>{{ seo_title }}</title>

        {%- if page_description -%}
          <meta name="description" content="{{ page_description | escape }}">
        {%- endif -%}

        <link rel="canonical" href="{{ canonical_url }}">

        {%- comment -%} Open Graph Meta Tags {%- endcomment -%}
        <meta property="og:site_name" content="{{ shop.name }}">
        <meta property="og:url" content="{{ canonical_url }}">
        <meta property="og:title" content="{{ meta_title | escape }}">
        <meta property="og:description" content="{{ meta_description | escape | truncate: 160 }}">
        
        {%- liquid
          case request.page_type
            when 'product'
              assign og_type = 'product'
              if product.featured_media
                assign og_image = product.featured_media | img_url: '1200x630'
              endif
            when 'article'
              assign og_type = 'article'
              if article.image
                assign og_image = article.image | img_url: '1200x630'
              endif
            when 'collection'
              assign og_type = 'website'
              if collection.featured_image
                assign og_image = collection.featured_image | img_url: '1200x630'
              endif
            else
              assign og_type = 'website'
          endcase

          unless og_image
            if settings.social_sharing_image
              assign og_image = settings.social_sharing_image | img_url: '1200x630'
            elsif settings.seo_default_og_image
              assign og_image = settings.seo_default_og_image | img_url: '1200x630'
            elsif shop.brand.logo
              assign og_image = shop.brand.logo | img_url: '1200x630'
            endif
          endunless
        -%}

        <meta property="og:type" content="{{ og_type }}">
        {%- if og_image -%}
          <meta property="og:image" content="https:{{ og_image }}">
          <meta property="og:image:secure_url" content="https:{{ og_image }}">
          <meta property="og:image:width" content="1200">
          <meta property="og:image:height" content="630">
        {%- endif -%}

        {%- if request.page_type == 'product' -%}
          <meta property="product:price:amount" content="{{ product.price | money_without_currency | strip_html }}">
          <meta property="product:price:currency" content="{{ cart.currency.iso_code }}">
          <meta property="product:availability" content="{% if product.available %}in stock{% else %}out of stock{% endif %}">
          <meta property="product:brand" content="{{ product.vendor | escape }}">
          <meta property="product:retailer_item_id" content="{{ product.id }}">
        {%- endif -%}

        {%- if request.page_type == 'article' -%}
          <meta property="article:published_time" content="{{ article.published_at | date: '%Y-%m-%d' }}">
          <meta property="article:modified_time" content="{{ article.updated_at | date: '%Y-%m-%d' }}">
          <meta property="article:author" content="{{ article.author | escape }}">
          <meta property="article:section" content="{{ blog.title | escape }}">
          {%- for tag in article.tags limit: 5 -%}
            <meta property="article:tag" content="{{ tag | escape }}">
          {%- endfor -%}
        {%- endif -%}

        {%- comment -%} Twitter Card Meta Tags {%- endcomment -%}
        <meta name="twitter:card" content="summary_large_image">
        {%- if settings.social_twitter_handle != blank -%}
          <meta name="twitter:site" content="@{{ settings.social_twitter_handle }}">
          <meta name="twitter:creator" content="@{{ settings.social_twitter_handle }}">
        {%- endif -%}
        <meta name="twitter:title" content="{{ meta_title | escape }}">
        <meta name="twitter:description" content="{{ meta_description | escape | truncate: 160 }}">
        {%- if og_image -%}
          <meta name="twitter:image" content="https:{{ og_image }}">
        {%- endif -%}

        <meta name="twitter:card" content="summary_large_image">
        <meta name="twitter:title" content="{{ page_title | escape }}">
        <meta name="twitter:description" content="{{ page_description | default: shop.description | default: shop.name | escape }}">

        <!-- Preload critical resources -->
        <link rel="preload" href="{{ 'theme.css' | asset_url }}" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="{{ 'theme.css' | asset_url }}"></noscript>
        
        {%- unless settings.heading_font.system? -%}
          <link rel="preload" as="font" href="{{ settings.heading_font | font_url }}" type="font/woff2" crossorigin>
        {%- endunless -%}
        {%- unless settings.body_font.system? -%}
          <link rel="preload" as="font" href="{{ settings.body_font | font_url }}" type="font/woff2" crossorigin>
        {%- endunless -%}

        <!-- DNS prefetch for external resources -->
        <link rel="dns-prefetch" href="https://cdn.shopify.com">
        <link rel="dns-prefetch" href="https://fonts.shopifycdn.com">
        <link rel="dns-prefetch" href="https://monorail-edge.shopifysvc.com">

        {{ content_for_header }}
        {% style %}
            {{ settings.heading_font | font_face: font_display: swap }}
            {{ settings.body_font | font_face: font_display: swap }}
            :root {
                /* Typography */
                --heading-font: {{ settings.heading_font.family }}, {{ settings.heading_font.fallback_families }};
                --body-font: {{ settings.body_font.family }}, {{ settings.body_font.fallback_families }};
                
                /* Colors */
                --color-primary: {{ settings.color_primary | default: '#2c2c2c' }};
                --color-secondary: {{ settings.color_secondary | default: '#666666' }};
                --color-accent: {{ settings.color_accent | default: '#007cba' }};
                --color-success: {{ settings.color_success | default: '#27ae60' }};
                --color-error: {{ settings.color_error | default: '#e74c3c' }};
                --color-background: {{ settings.color_background | default: '#fafafa' }};
                --color-background-secondary: {{ settings.color_background_secondary | default: '#ffffff' }};
                
                /* Layout */
                --container-max-width: {{ settings.container_max_width | default: 1200 }}px;
                --section-vertical-spacing: {{ settings.section_vertical_spacing | default: 60 }}px;
                --button-border-radius: {{ settings.button_border_radius | default: 2 }}px;
                
                /* Animation */
                --animation-speed: {% case settings.animations_speed %}
                    {% when 'slow' %}0.4s
                    {% when 'fast' %}0.15s
                    {% else %}0.25s
                {% endcase %};
            }
            
            /* Apply background colors */
            body {
                background-color: var(--color-background);
            }
            
            .container {
                max-width: var(--container-max-width);
            }
            
            /* Button styles based on settings */
            .btn, .button, .add-to-cart-btn, .newsletter-form__button, .search-submit {
                border-radius: var(--button-border-radius);
                {% if settings.button_style == 'outline' %}
                    background: transparent;
                    color: var(--color-primary);
                    border: 2px solid var(--color-primary);
                {% else %}
                    background: var(--color-primary);
                    color: white;
                    border: 2px solid var(--color-primary);
                {% endif %}
                transition: all var(--animation-speed) ease;
            }
            
            .btn:hover, .button:hover, .add-to-cart-btn:hover, .newsletter-form__button:hover {
                {% if settings.button_style == 'outline' %}
                    background: var(--color-primary);
                    color: white;
                {% else %}
                    opacity: 0.9;
                    transform: translateY(-1px);
                {% endif %}
            }
            
            /* Disable animations if setting is turned off */
            {% unless settings.animations_enable %}
            *, *::before, *::after {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
                scroll-behavior: auto !important;
            }
            {% endunless %}
        {% endstyle %}
        <link href="{{ 'theme.css' | asset_url }}" rel="stylesheet" type="text/css" media="all" />

        <script>
          window.theme = window.theme || {};
          window.theme.moneyFormat = {{ shop.money_format | json }};
          window.theme.routes = {
            root: {{ routes.root_url | json }},
            account: {{ routes.account_url | json }},
            search: {{ routes.search_url | json }},
            cart: {{ routes.cart_url | json }},
            cartAdd: {{ routes.cart_add_url | json }},
            cartChange: {{ routes.cart_change_url | json }},
            cartUpdate: {{ routes.cart_update_url | json }},
            cartClear: {{ routes.cart_clear_url | json }}
          };
        </script>
        
        {%- comment -%} Structured Data for Rich Snippets {%- endcomment -%}
        <script type="application/ld+json">
        {
          "@context": "https://schema.org",
          "@type": "{% if request.page_type == 'product' %}Product{% elsif request.page_type == 'article' %}BlogPosting{% elsif request.page_type == 'blog' %}Blog{% else %}WebSite{% endif %}",
          {% if request.page_type == 'index' or request.page_type == 'collection' or request.page_type == 'blog' or request.page_type == 'page' %}
            "name": {{ meta_title | json }},
            "url": {{ shop.url | append: request.path | json }},
            "description": {{ meta_description | json }},
            "potentialAction": {
              "@type": "SearchAction",
              "target": "{{ shop.url }}/search?q={search_term_string}",
              "query-input": "required name=search_term_string"
            }
          {% endif %}
          {% if request.page_type == 'product' %}
            "name": {{ product.title | json }},
            "description": {{ product.description | strip_html | truncatewords: 25 | json }},
            "image": [
              {% for image in product.images limit: 3 %}
                {{ image | img_url: '800x800' | prepend: 'https:' | json }}{% unless forloop.last %},{% endunless %}
              {% endfor %}
            ],
            "brand": {
              "@type": "Brand",
              "name": {{ product.vendor | json }}
            },
            "offers": {
              "@type": "Offer",
              "priceCurrency": {{ cart.currency.iso_code | json }},
              "price": "{{ product.price | money_without_currency | remove: ',' }}",
              "availability": "{% if product.available %}https://schema.org/InStock{% else %}https://schema.org/OutOfStock{% endif %}",
              "seller": {
                "@type": "Organization",
                "name": {{ shop.name | json }}
              }
            },
            {% if product.variants.size > 1 %}
              "hasVariant": [
                {% for variant in product.variants %}
                  {
                    "@type": "ProductModel",
                    "name": {{ variant.title | json }},
                    "offers": {
                      "@type": "Offer",
                      "priceCurrency": {{ cart.currency.iso_code | json }},
                      "price": "{{ variant.price | money_without_currency | remove: ',' }}",
                      "availability": "{% if variant.available %}https://schema.org/InStock{% else %}https://schema.org/OutOfStock{% endif %}"
                    }
                  }{% unless forloop.last %},{% endunless %}
                {% endfor %}
              ],
            {% endif %}
            "aggregateRating": {
              "@type": "AggregateRating",
              "ratingValue": "4.5",
              "reviewCount": "{{ product.metafields.reviews.count | default: 1 }}"
            }
          {% endif %}
          {% if request.page_type == 'article' %}
            "headline": {{ article.title | json }},
            "description": {{ article.excerpt | default: article.content | strip_html | truncatewords: 25 | json }},
            "image": {{ article.image | img_url: '1200x630' | prepend: 'https:' | json }},
            "datePublished": {{ article.published_at | date: '%Y-%m-%d' | json }},
            "dateModified": {{ article.updated_at | date: '%Y-%m-%d' | json }},
            "author": {
              "@type": "Person",
              "name": {{ article.author | json }}
            },
            "publisher": {
              "@type": "Organization",
              "name": {{ shop.name | json }},
              "logo": {
                "@type": "ImageObject",
                "url": {{ shop.brand.logo | default: settings.social_sharing_image | img_url: '200x200' | prepend: 'https:' | json }}
              }
            },
            "mainEntityOfPage": {
              "@type": "WebPage",
              "@id": {{ shop.url | append: article.url | json }}
            }
          {% endif %}
        }
        </script>

        {%- comment -%} Organization Schema {%- endcomment -%}
        <script type="application/ld+json">
        {
          "@context": "https://schema.org",
          "@type": "Organization",
          "name": {{ shop.name | json }},
          "url": {{ shop.url | json }},
          {% if shop.description %}
            "description": {{ shop.description | json }},
          {% endif %}
          {% if settings.social_sharing_image or settings.seo_default_og_image or shop.brand.logo %}
            "logo": {{ shop.brand.logo | default: settings.social_sharing_image | default: settings.seo_default_og_image | img_url: '200x200' | prepend: 'https:' | json }},
          {% endif %}
          "sameAs": [
            {% if settings.social_facebook_url != blank %}
              {{ settings.social_facebook_url | json }}{% if settings.social_instagram_url != blank or settings.social_twitter_url != blank %},{% endif %}
            {% endif %}
            {% if settings.social_instagram_url != blank %}
              {{ settings.social_instagram_url | json }}{% if settings.social_twitter_url != blank %},{% endif %}
            {% endif %}
            {% if settings.social_twitter_url != blank %}
              {{ settings.social_twitter_url | json }}
            {% endif %}
          ]
        }
        </script>

        <script src="{{ 'theme.js' | asset_url }}" defer></script>
        
        {%- comment -%} Additional SEO Enhancements {%- endcomment -%}
        {% render 'seo-enhancements' %}
    </head>
    <body>
        {% sections 'header-group' %}
        {{ content_for_layout }}
        {% sections 'footer-group' %}
    </body>
</html>