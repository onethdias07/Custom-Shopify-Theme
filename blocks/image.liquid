{% comment %}
  Image Block - Responsive image with full styling control
{% endcomment %}

{%- liquid
  assign image = block.settings.image
  assign image_alt = block.settings.image_alt | default: image.alt
  assign image_width = block.settings.image_width | default: 100
  assign image_height = block.settings.image_height | default: 'auto'
  assign custom_height = block.settings.custom_height | default: 300
  assign object_fit = block.settings.object_fit | default: 'cover'
  assign border_radius = block.settings.border_radius | default: 0
  assign image_alignment = block.settings.image_alignment | default: 'center'
  assign max_width = block.settings.max_width | default: 1200
  assign enable_link = block.settings.enable_link
  assign image_link = block.settings.image_link
  assign open_in_new_tab = block.settings.open_in_new_tab
  
  assign link_target = '_self'
  if open_in_new_tab
    assign link_target = '_blank'
  endif
-%}

<style>
  .image-container-{{ block.id }} {
    text-align: {{ image_alignment }};
    width: 100%;
  }
  
  .image-wrapper-{{ block.id }} {
    display: inline-block;
    width: {{ image_width }}%;
    max-width: {{ max_width }}px;
    
    {% if image_alignment == 'center' %}
      margin-left: auto;
      margin-right: auto;
    {% elsif image_alignment == 'right' %}
      margin-left: auto;
    {% endif %}
  }
  
  .image-{{ block.id }} {
    width: 100%;
    {% if image_height == 'custom' %}
      height: {{ custom_height }}px;
    {% else %}
      height: {{ image_height }};
    {% endif %}
    
    object-fit: {{ object_fit }};
    border-radius: {{ border_radius }}px;
    display: block;
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }
  
  {% if enable_link %}
  .image-link-{{ block.id }}:hover .image-{{ block.id }} {
    transform: scale(1.02);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
  }
  {% endif %}
  
  /* Responsive adjustments */
  @media screen and (max-width: 768px) {
    .image-wrapper-{{ block.id }} {
      width: 100%;
    }
    
    .image-{{ block.id }} {
      {% if image_height == 'custom' and custom_height > 400 %}
        height: {{ custom_height | divided_by: 1.5 }}px;
      {% endif %}
    }
  }
  
  @media screen and (max-width: 480px) {
    .image-{{ block.id }} {
      {% if image_height == 'custom' and custom_height > 300 %}
        height: {{ custom_height | divided_by: 2 }}px;
      {% endif %}
    }
  }
</style>

<div class="image-container-{{ block.id }}">
  <div class="image-wrapper-{{ block.id }}">
    {% if enable_link and image_link != blank %}
      <a href="{{ image_link }}" 
         class="image-link-{{ block.id }}" 
         target="{{ link_target }}"
         {{ block.shopify_attributes }}>
        {% if image != blank %}
          <img src="{{ image | image_url: width: max_width }}"
               class="image-{{ block.id }}"
               alt="{{ image_alt }}"
               loading="lazy"
               sizes="(max-width: 480px) 100vw, (max-width: 768px) 100vw, {{ image_width }}vw">
        {% else %}
          <div class="image-{{ block.id }}" style="background-color: #f5f5f5; display: flex; align-items: center; justify-content: center; color: #999;">
            <span>Select an image</span>
          </div>
        {% endif %}
      </a>
    {% else %}
      {% if image != blank %}
        <img src="{{ image | image_url: width: max_width }}"
             class="image-{{ block.id }}"
             alt="{{ image_alt }}"
             loading="lazy"
             sizes="(max-width: 480px) 100vw, (max-width: 768px) 100vw, {{ image_width }}vw"
             {{ block.shopify_attributes }}>
      {% else %}
        <div class="image-{{ block.id }}" style="background-color: #f5f5f5; display: flex; align-items: center; justify-content: center; color: #999;" {{ block.shopify_attributes }}>
          <span>Select an image</span>
        </div>
      {% endif %}
    {% endif %}
  </div>
</div>

{% schema %}
{
  "name": "Image",
  "settings": [
    {
      "type": "header",
      "content": "Image Settings"
    },
    {
      "type": "image_picker",
      "id": "image",
      "label": "Image",
      "info": "Select an image from your media library"
    },
    {
      "type": "text",
      "id": "image_alt",
      "label": "Alt Text",
      "info": "Describe the image for accessibility. Leave blank to use the image's alt text."
    },
    {
      "type": "header",
      "content": "Image Dimensions"
    },
    {
      "type": "range",
      "id": "image_width",
      "min": 10,
      "max": 100,
      "step": 1,
      "unit": "%",
      "label": "Image Width",
      "default": 100,
      "info": "Percentage of container width"
    },
    {
      "type": "select",
      "id": "image_height",
      "label": "Image Height",
      "options": [
        {
          "value": "auto",
          "label": "Auto (Maintain Aspect Ratio)"
        },
        {
          "value": "custom",
          "label": "Custom Height"
        }
      ],
      "default": "auto"
    },
    {
      "type": "range",
      "id": "custom_height",
      "min": 100,
      "max": 800,
      "step": 10,
      "unit": "px",
      "label": "Custom Height",
      "default": 300,
      "info": "Only applies when 'Custom Height' is selected above"
    },
    {
      "type": "range",
      "id": "max_width",
      "min": 200,
      "max": 2000,
      "step": 50,
      "unit": "px",
      "label": "Maximum Width",
      "default": 1200,
      "info": "Maximum width the image can reach"
    },
    {
      "type": "header",
      "content": "Image Styling"
    },
    {
      "type": "select",
      "id": "object_fit",
      "label": "Image Fit",
      "options": [
        {
          "value": "cover",
          "label": "Cover (Fill container, may crop)"
        },
        {
          "value": "contain",
          "label": "Contain (Fit entirely, may show space)"
        },
        {
          "value": "fill",
          "label": "Fill (Stretch to fill)"
        },
        {
          "value": "scale-down",
          "label": "Scale Down (Smaller of contain or original)"
        }
      ],
      "default": "cover"
    },
    {
      "type": "range",
      "id": "border_radius",
      "min": 0,
      "max": 50,
      "step": 1,
      "unit": "px",
      "label": "Border Radius",
      "default": 0
    },
    {
      "type": "select",
      "id": "image_alignment",
      "label": "Image Alignment",
      "options": [
        {
          "value": "left",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Center"
        },
        {
          "value": "right",
          "label": "Right"
        }
      ],
      "default": "center"
    },
    {
      "type": "header",
      "content": "Link Settings"
    },
    {
      "type": "checkbox",
      "id": "enable_link",
      "label": "Make image clickable",
      "default": false
    },
    {
      "type": "url",
      "id": "image_link",
      "label": "Image Link",
      "info": "Link destination when image is clicked"
    },
    {
      "type": "checkbox",
      "id": "open_in_new_tab",
      "label": "Open link in new tab",
      "default": false
    }
  ],
  "presets": [
    {
      "name": "Image",
      "category": "Media"
    }
  ]
}
{% endschema %}
